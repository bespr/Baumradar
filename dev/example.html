<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <title>WMTS Viewer</title>

    <!-- Proj4js -->
    <script src="lib/proj4js-compressed.js" type="text/javascript"></script>
    <script src="lib/EPSG21781.js" type="text/javascript"></script>

    <!-- OpenLayers 3 -->
    <script src="lib/ol.js"></script>
    <link rel="stylesheet" href="lib/ol.css" />

    <style type="text/css">
      #map {
        height: 400px;
        width: 100%;
      }
    </style>

  </head>
  <body>
    <h3>WMTS Viewer</h3>
    <div id="map"></div>
    <div id="layerSwitcher"></div>

    <script type="text/javascript">
      // ZH
      var projection = ol.proj.configureProj4jsProjection({
        code: 'EPSG:21781',
        extent: [420000, 30000, 900000, 350000]
      });
      console.log(projection)
      //var wmtsUrl = '../WMTSCapabilities_ALL.xml'; 
      var wmtsUrl = 'data/WMTSCapabilities.xml'; 
      //var wmtsUrl = 'http://szhm23616.global.szh.loc/wmts/WMTS-ZH-STZH-OGD.xml';
      //var wmtsUrl = 'data/swisstopo_WMTSCapabilities.xml'; // http://api.geo.admin.ch/main/wsgi/layers?mode=wmts
      var center = [683200, 246650];
      var zoom = 11;


/*      // ol3 sample
      var projection = ol.proj.configureProj4jsProjection({
          code: 'EPSG:3875',
          extent: [-20037508.342789244, -20037508.342789244, 20037508.342789244, 20037508.342789244]
      });
      var wmtsUrl = 'data/ol3_demo_WMTSCapabilities.xml';
      var center = [1823849.418472, 6143760.787973501];
      var zoom = 11;
*/

      var layerSwitcher = document.getElementById('layerSwitcher');
      var layers = [];
      var map, capabilities;
      var xhr = new XMLHttpRequest();
      xhr.open('GET', wmtsUrl, true);
      xhr.onload = function() {
          if (xhr.status === 200) {
              var parser = new ol.parser.ogc.WMTSCapabilities();
              capabilities = parser.read(xhr.responseXML);
              console.log(capabilities)

              // get all layers from capabilities
              
              for (var i=0; i<capabilities.contents.layers.length; i++) {
                  var layer = capabilities.contents.layers[i];

                  console.log(JSON.stringify(ol.source.WMTS.optionsFromCapabilities(capabilities, layer.identifier)))

                   console.log(ol.source.WMTS.optionsFromCapabilities(capabilities, layer.identifier).urls[0])

                  var olLayer = new ol.layer.Tile({
                      source: new ol.source.WMTS(ol.source.WMTS.optionsFromCapabilities(capabilities, layer.identifier)),
                      visible: i === 0
                  })
                  layers.push(olLayer);

                  // add layer to layer switcher
                  var chkbox = document.createElement('input');
                  chkbox.type = 'checkbox';
                  chkbox.id = "layer_" + layer.identifier;
                  var label = document.createTextNode(layer.identifier);
                  layerSwitcher.appendChild(chkbox);
                  layerSwitcher.appendChild(label);
                  layerSwitcher.appendChild(document.createElement('br'));

                  // bind to OpenLayers layer
                  new ol.dom.Input(chkbox).bindTo('checked', olLayer, 'visible');
              };

              // create map
              map = new ol.Map({
                  layers: layers,
                  target: 'map',
                  view: new ol.View2D({
                      projection: projection,
                      center: center,
                      zoom: zoom
                  })
              });
              map.addControl(new ol.control.MousePosition());
          }
      };
      xhr.send();
    </script>
  </body>
</html>

